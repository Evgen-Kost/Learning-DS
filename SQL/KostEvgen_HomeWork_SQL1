-- Ссылка на тренажер https://www.w3schools.com/sql/trysql.asp?filename=trysql_select_all
--Презентация https://docs.google.com/presentation/d/1NglwaN4XyIpkVkFPrpSWzCXBTsLtdJ5F81XFwp-L7f0/edit#slide=id.p39

-- 1. Выберите заказчиков из Германии, Франции и Мадрида, выведите их название, страну и адрес.
SELECT CustomerName,Country,Address
FROM Customers
WHERE Country IN ('Germany','France') OR City = 'Madrid'
ORDER BY Country
 	
--2. Выберите топ 3 страны по количеству заказчиков, выведите их названия и количество записей.
SELECT Country,COUNT(CustomerName) AS count
FROM Customers
GROUP BY Country 
ORDER BY count DESC 
LIMIT 3
    
--3. Выберите перевозчика, который отправил 10-й по времени заказ, выведите его название, и дату отправления.
SELECT shippers.ShipperName,orders.OrderDate 
FROM [Orders] as orders
LEFT JOIN [Shippers] as shippers ON shippers.ShipperID = orders.ShipperID
ORDER BY orders.OrderDate
LIMIT 1 
OFFSET 9 -- 10 заказ по времени, Индекс начинается с нуля

--4. Выберите самый дорогой заказ, выведите список товаров с их ценами.
SELECT products.ProductName,orderDetails.Quantity,products.Price
FROM [OrderDetails] as orderDetails
LEFT JOIN [Products] AS products ON products.ProductID = orderDetails.ProductID
WHERE orderDetails.OrderID IN
(
SELECT orderDetails.OrderID
FROM [OrderDetails] as orderDetails
LEFT JOIN [Products] as products ON orderDetails.ProductID = products.ProductID
GROUP BY orderDetails.OrderID
ORDER BY SUM(orderDetails.Quantity*products.Price) DESC 
LIMIT 1
)

--5. Какой товар больше всего заказывали по количеству единиц товара, выведите его название и количество единиц в каждом из заказов.
SELECT products.ProductName,orderDetails.orderID,orderDetails.Quantity 
FROM [OrderDetails] AS orderDetails
LEFT JOIN [Products] AS products ON products.ProductID = orderDetails.ProductID
WHERE orderDetails.ProductID IN
(
SELECT ProductID FROM [OrderDetails] 
GROUP BY ProductID
ORDER BY SUM(Quantity) DESC 
LIMIT 1
)

-- 6. Выведите топ 5 поставщиков по количеству заказов, выведите их названия, страну, контактное лицо и телефон.
SELECT SupplierName,Country,ContactName,Phone 
FROM [Suppliers]
WHERE SupplierID IN
(
SELECT products.SupplierID
FROM [OrderDetails] as orderDetails
LEFT JOIN [Products] as products ON products.ProductID = orderDetails.ProductID
GROUP BY products.SupplierID
ORDER BY COUNT(orderDetails.OrderID) DESC 
LIMIT 5
)

-- 7. Какую категорию товаров заказывали больше всего по стоимости в Бразилии, выведите страну, название категории и сумму.
SELECT customers.Country,categories.CategoryName,SUM(orderDetails.Quantity*products.Price) AS PriceOrder 
FROM [OrderDetails] AS orderDetails
LEFT JOIN [Products] AS products ON products.ProductID = orderDetails.ProductID
LEFT JOIN [Categories] AS categories ON [Categories].CategoryID = products.CategoryID
LEFT JOIN [Orders] AS orders ON orders.OrderID = orderDetails.OrderID
LEFT JOIN [Customers] AS customers ON customers.CustomerID = orders.CustomerID
WHERE customers.Country = 'Brazil'
GROUP BY categories.CategoryName
ORDER BY PriceOrder DESC
LIMIT 1

-- 8. Какая разница в стоимости между самым дорогим и самым дешевым заказом из США.
SELECT MAX(orderDetails.Quantity*products.Price)-MIN(orderDetails.Quantity*products.Price)
FROM [Orders] AS orders
LEFT JOIN [OrderDetails] AS orderDetails ON orderDetails.OrderID = orders.OrderID
LEFT JOIN [Products] AS products ON products.ProductID = orderDetails.ProductID
LEFT JOIN [Customers] as customers ON customers.CustomerID = orders.CustomerID
WHERE customers.Country = 'USA'

-- 9. Выведите количество заказов у каждого их трех самых молодых сотрудников, а также имя и фамилию во второй колонке.
SELECT employees.FirstName || ' ' || employees.LastName AS name,COUNT(orders.OrderID)
FROM [Employees] AS employees
LEFT JOIN [Orders] AS orders
ON orders.EmployeeID = employees.EmployeeID
GROUP BY orders.EmployeeID
ORDER BY employees.BirthDate DESC
LIMIT 3

-- 10. Сколько банок крабового мяса всего было заказано
SELECT SUM(orderDetails.Quantity) AS crabCans 
FROM [OrderDetails] AS orderDetails
WHERE ProductID = 
(
SELECT ProductID FROM [Products]
WHERE ProductName = 'Boston Crab Meat'
)
GROUP BY orderDetails.ProductID
